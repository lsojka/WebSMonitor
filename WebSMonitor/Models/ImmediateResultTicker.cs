using Microsoft.AspNet.SignalR;
using Microsoft.AspNet.SignalR.Hubs;
using System;
using System.Collections.Generic;
using System.Collections.Concurrent;
using System.Linq;
using System.Web;
using System.Threading;
using WebSMonitor.Models;

namespace WebSMonitor.Models
{
    public class ImmediateResultTicker
    {
        // Signleton instance of the hub
        private readonly static Lazy<ImmediateResultTicker> _instance = new Lazy<ImmediateResultTicker>(() => new ImmediateResultTicker(GlobalHost.ConnectionManager.GetHubContext<ImmediateResultTickerHub>().Clients));
        //private Microsoft.AspNet.SignalR.Hubs.IHubConnectionContext<dynamic> clients;
        
        // threadsafe collection for data
        private readonly BlockingCollection<OptiNurbsImmediateResult> _results = new BlockingCollection<OptiNurbsImmediateResult>();

        private readonly Timer _timer;
        private readonly TimeSpan _interval = TimeSpan.FromSeconds(10);

        public ImmediateResultTicker(IHubConnectionContext<dynamic> clients)
        {
            Clients = clients;
            // clear the _results?

            var results = new List<OptiNurbsImmediateResult>
            {
                new OptiNurbsImmediateResult{ Dpc = 20, ErrorValue = 1.05, ControlPoints = "0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 0 0 60; 306.044 0 60; 338.4919 71.94868 60; 229.1111 102.0069 60; 221.7894 161.1394 60; 188.2318 209.0526 60; 166.3611 288.1459 60; 104.1691 320.5996 60; 36.89511 351.0336 60; -41.09216 390.9656 60; -93.59635 288.0599 60; -171.5555 297.1429 60; -203.9633 226.5242 60; -258.701 187.9572 60; -252.0274 112.2098 60; -348.8676 74.15408 60; -330.892 -2.89275E-05 60; -302.7838 -64.35872 60; -325.4759 -144.9112 60; -252.7234 -183.6144 60; -242.1509 -268.9359 60; -141.6435 -245.3338 60; -93.71365 -288.4209 60; -39.56888 -376.4715 60; 41.27177 -392.6768 60; 88.41502 -272.1142 60; 169.5668 -293.6991 60; 223.23 -247.9226 60; 315.0924 -228.9288 60; 288.665 -128.5226 60; 247.5735 -52.62387 60; 612.088 0 120; 676.9839 143.8974 120; 458.2223 204.0137 120; 443.5788 322.2789 120; 376.4637 418.1053 120; 332.7221 576.2917 120; 208.3382 641.1992 120; 73.79021 702.0673 120; -82.18432 781.9313 120; -187.1927 576.1198 120; -343.1111 594.2857 120; -407.9266 453.0483 120; -517.402 375.9145 120; -504.0548 224.4196 120; -697.7353 148.3082 120; -661.7841 -5.7855E-05 120; -605.5676 -128.7174 120; -650.9517 -289.8224 120; -505.4469 -367.2287 120; -484.3018 -537.8718 120; -283.287 -490.6677 120; -187.4273 -576.8417 120; -79.13776 -752.9429 120; 82.54353 -785.3537 120; 176.83 -544.2285 120; 339.1337 -587.3981 120; 446.4599 -495.8453 120; 630.1849 -457.8576 120; 577.3301 -257.0451 120; 495.1469 -105.2477 120; 732.7963 0 180; 589.2797 125.2553 180; 535.2248 238.2974 180; 599.0079 435.2047 180; 447.7921 497.3236 180; 287.4117 497.8116 180; 163.6282 503.5959 180; 71.63149 681.5284 180; -72.91852 693.7731 180; -192.1229 591.2933 180; -317.403 549.7581 180; -392.5926 436.0182 180; -531.3914 386.0784 180; -538.7068 239.8477 180; -699.0815 148.5943 180; -705.1006 -6.164185E-05 180; -737.9733 -156.8611 180; -665.5593 -296.3262 180; -604.2359 -439.0032 180; -419.1353 -465.497 180; -342.0757 -592.4926 180; -170.9324 -526.0755 180; -65.74904 -625.5582 180; 82.33411 -783.3611 180; 217.7527 -670.1756 180; 252.7799 -437.8287 180; 491.8221 -546.2253 180; 414.1411 -300.8921 180; 708.9638 -315.6525 180; 669.3927 -142.2852 180; 798.2195 0 240; 680.0518 144.5495 240; 524.3454 233.4536 240; 631.057 458.4897 240; 450.3061 500.1156 240; 291.8887 505.5662 240; 161.8508 498.1256 240; 73.0789 695.2996 240; -71.34507 678.8027 240; -197.3073 607.2494 240; -316.136 547.5636 240; -491.0174 545.33 240; -416.6121 302.6863 240; -459.5537 204.6065 240; -576.1014 122.4541 240; -779.8539 -6.817699E-05 240; -733.3089 -155.8697 240; -609.7024 -271.4571 240; -465.1687 -337.9649 240; -446.4003 -495.7778 240; -361.9042 -626.8365 240; -228.2646 -702.5259 240; -55.61721 -529.1607 240; 52.8471 -502.8094 240; 192.2259 -591.612 240; 339.8233 -588.5926 240; 517.532 -574.779 240; 483.9538 -351.6142 240; 489.432 -217.9102 240; 649.1515 -137.9827 240; 639.8056 0 300; 506.294 107.6161 300; 647.9087 288.4675 300; 415.2256 301.679 300; 417.205 463.3531 300; 369.7807 640.4791 300; 158.4493 487.6569 300; 70.74551 673.0989 300; -74.91727 712.7899 300; -194.9656 600.0424 300; -340.6703 590.0581 300; -371.5887 412.6911 300; -441.7263 320.9329 300; -555.78 247.4492 300; -776.7626 165.1059 300; -750.3376 -6.559659E-05 300; -526.4271 -111.8956 300; -571.8428 -254.6009 300; -565.2635 -410.6881 300; -484.9927 -538.639 300; -277.9346 -481.3969 300; -175.4028 -539.8342 300; -77.0301 -732.89 300; 63.64946 -605.5876 300; 235.0189 -723.3159 300; 279.7695 -484.5762 300; 443.7461 -492.8312 300; 459.8354 -334.0911 300; 601.0867 -267.6223 300; 775.9877 -164.9429 300; 610.3369 0 360; 709.7045 150.8524 360; 606.0269 269.8206 360; 419.7888 304.9944 360; 534.4307 593.5455 360; 307.3336 532.3174 360; 162.1071 498.9144 360; 52.44335 498.9654 360; -71.03142 675.8185 360; -200.6788 617.6259 360; -383.5506 664.329 360; -383.3349 425.7365 360; -607.3179 441.2422 360; -679.7311 302.6357 360; -768.6229 163.3758 360; -668.4778 -5.844019E-05 360; -677.5391 -144.0155 360; -661.1315 -294.3548 360; -413.7823 -300.6305 360; -449.4683 -499.1852 360; -320.73 -555.5208 360; -200.0826 -615.7907 360; -73.11751 -695.6643 360; 63.86028 -607.5934 360; 187.8154 -578.038 360; 286.0946 -495.5316 360; 388.5488 -431.5283 360; 485.6533 -352.8489 360; 504.9234 -224.8074 360; 551.6389 -117.2556 360; 576.3925 0 420; 728.0981 154.762 420; 473.9791 211.0291 420; 585.2365 425.1992 420; 348.3393 386.8701 420; 377.8904 654.5253 420; 213.8248 658.085 420; 55.09861 524.2285 420; -63.72923 606.3429 420; -209.9612 646.1942 420; -362.8741 628.5162 420; -358.9712 398.6778 420; -603.8655 438.7339 420; -501.805 223.4179 420; -741.1514 157.5365 420; -782.9843 -6.845066E-05 420; -603.4478 -128.2668 420; -724.3215 -322.4888 420; -504.1218 -366.266 420; -396.1663 -439.9873 420; -333.4321 -577.5214 420; -228.509 -703.2782 420; -58.21475 -553.8745 420; 82.18524 -781.9448 420; 201.4366 -619.9597 420; 381.4274 -660.6533 420; 352.0047 -390.9418 420; 446.932 -324.7162 420; 649.624 -289.2326 420; 710.6277 -151.0501 420; 533.9893 0 480; 708.4611 150.588 480; 684.251 304.6482 480; 498.0131 361.8277 480; 383.4238 425.8353 480; 261.3684 452.7034 480; 171.2109 526.9331 480; 55.11723 524.4056 480; -75.62359 719.5101 480; -163.7832 504.0729 480; -388.2632 672.4915 480; -445.3464 494.6072 480; -496.7492 360.9094 480; -577.3738 257.0633 480; -729.6707 155.0962 480; -604.9861 -5.288957E-05 480; -685.742 -145.759 480; -593.9894 -264.4612 480; -528.4749 -383.9596 480; -418.0732 -464.3174 480; -377.6305 -654.0754 480; -181.6431 -559.0398 480; -81.23689 -772.9147 480; 79.50877 -756.4797 480; 215.4148 -662.9805 480; 318.4604 -551.5909 480; 459.9857 -510.8672 480; 430.8681 -313.045 480; 522.1165 -232.4623 480; 545.5408 -115.9594 480; 729.7173 0 540; 625.5377 132.9621 540; 562.7563 250.5553 540; 552.7033 401.5625 540; 431.8967 479.67 540; 250.7297 434.2767 540; 181.5376 558.7153 540; 65.94078 627.3849 540; -81.14298 772.0236 540; -227.119 699.0002 540; -364.4671 631.2754 540; -394.5428 438.1842 540; -460.6505 334.6821 540; -541.8378 241.2417 540; -602.0841 127.9769 540; -501.3046 -4.382544E-05 540; -611.787 -130.0394 540; -662.2393 -294.848 540; -437.0956 -317.5686 540; -365.9327 -406.4095 540; -280.8971 -486.5282 540; -208.8526 -642.782 540; -73.08739 -695.3777 540; 61.28489 -583.0901 540; 238.3265 -733.4957 540; 373.0893 -646.2112 540; 499.9177 -555.2162 540; 637.7954 -463.387 540; 656.363 -292.233 540; 720.0102 -153.0444 540; 635.298 0 600; 510.0721 108.4192 600; 690.4267 307.3978 600; 538.5987 391.3148 600; 401.6766 446.1071 600; 318.5069 551.6702 600; 169.8191 522.6494 600; 76.39323 726.8333 600; -82.21739 782.2459 600; -230.067 708.0734 600; -258.7591 448.1838 600; -381.5525 423.7569 600; -545.2179 396.1239 600; -656.1619 292.142 600; -680.6603 144.6788 600; -665.6262 -5.819089E-05 600; -507.0853 -107.7844 600; -624.9171 -278.2311 600; -521.9062 -379.1871 600; -465.5771 -517.0759 600; -255.7335 -442.9436 600; -235.6341 -725.2068 600; -82.81848 -787.9626 600; 54.84056 -521.7761 600; 245.9566 -756.9788 600; 276.9276 -479.6538 600; 495.3597 -550.1541 600; 428.5453 -311.3574 600; 650.3855 -289.5716 600; 683.9984 -145.3897 600; 554.3433 0 660; 586.0167 124.5617 660; 650.7745 289.7435 660; 437.0149 317.5099 660; 401.2605 445.645 660; 353.7333 612.6841 660; 195.8762 602.8451 660; 73.55149 699.796 660; -82.87218 788.4758 660; -240.5763 740.4177 660; -375.8793 651.0419 660; -464.7901 516.2017 660; -597.343 433.995 660; -544.2607 242.3204 660; -517.7921 110.0601 660; -791.5731 -6.920152E-05 660; -490.9663 -104.3582 660; -713.4329 -317.6409 660; -558.5738 -405.8277 660; -405.2365 -450.0609 660; -363.883 -630.2639 660; -173.9949 -535.5012 660; -67.23792 -639.724 660; 54.63518 -519.8219 660; 223.9221 -689.1631 660; 336.3846 -582.6365 660; 354.0797 -393.2463 660; 591.4847 -429.7401 660; 611.9017 -272.4374 660; 534.4989 -113.6124 660; 696.7093 0 720; 508.4748 108.0797 720; 474.0394 211.056 720; 475.1156 345.1917 720; 461.8133 512.8957 720; 359.2047 622.1609 720; 203.2899 625.6619 720; 66.24448 630.2745 720; -64.65968 615.1955 720; -243.629 749.813 720; -265.8787 460.5154 720; -411.357 456.8581 720; -559.2234 406.2995 720; -608.9606 271.1267 720; -727.7767 154.6936 720; -616.8492 -5.392668E-05 720; -512.7168 -108.9814 720; -636.3168 -283.3065 720; -643.4033 -467.46 720; -337.4835 -374.8135 720; -275.9607 -477.978 720; -234.6537 -722.1895 720; -66.82281 -635.7744 720; 63.3773 -602.9981 720; 238.4102 -733.7532 720; 395.6413 -685.2724 720; 505.7689 -561.7147 720; 557.9591 -405.3823 720; 562.3337 -250.3683 720; 711.0192 -151.1333 720; 678.3021 0 780; 687.3959 146.1105 780; 487.6875 217.1325 780; 603.8331 438.7104 780; 389.3081 432.3705 780; 365.962 633.8649 780; 208.8081 642.6452 780; 68.0565 647.5146 780; -73.75513 701.733 780; -188.7941 581.0483 780; -316.8567 548.8118 780; -447.1055 496.5609 780; -535.8649 389.3286 780; -641.3411 285.5434 780; -561.319 119.312 780; -613.0028 -5.35904E-05 780; -657.1403 -139.6796 780; -709.5118 -315.8951 780; -468.1373 -340.1217 780; -406.6838 -451.6682 780; -324.2995 -561.7034 780; -195.4932 -601.666 780; -76.91499 -731.7948 780; 69.55798 -661.8036 780; 245.5192 -755.6324 780; 368.6765 -638.5679 780; 455.3815 -505.7537 780; 576.4897 -418.8456 780; 562.5259 -250.4538 780; 683.6126 -145.3078 780; 762.5486 0 840; 751.3971 159.7144 840; 473.3945 210.7688 840; 559.581 406.5594 840; 408.2352 453.3911 840; 314.5023 544.734 840; 179.515 552.4905 840; 77.85897 740.7789 840; -61.12602 581.575 840; -158.2512 487.0471 840; -370.5661 641.8392 840; -450.3851 500.2033 840; -639.8817 464.9012 840; -625.1757 278.3461 840; -655.9927 139.4355 840; -683.7328 -5.977382E-05 840; -583.9439 -124.1212 840; -673.5034 -299.8631 840; -430.7694 -312.9724 840; -440.6296 -489.3689 840; -309.7313 -536.4705 840; -240.7872 -741.0665 840; -63.86988 -607.6793 840; 53.07631 -504.9902 840; 178.7056 -550.0008 840; 272.8361 -472.567 840; 513.1736 -569.9385 840; 540.7394 -392.8715 840; 686.8578 -305.8102 840; 630.3744 -133.9915 840; 551.3661 0 900; 746.4596 158.6649 900; 489.0388 217.7341 900; 409.9395 297.8385 900; 433.8654 481.8564 900; 332.7648 576.3655 900; 200.8591 618.1808 900; 80.55851 766.4634 900; -61.87432 588.6946 900; -230.1728 708.3988 900; -266.04 460.7947 900; -486.4325 540.2379 900; -559.7419 406.6762 900; -517.5582 230.4317 900; -652.0795 138.6037 900; -775.5092 -6.779716E-05 900; -627.6694 -133.4153 900; -503.8073 -224.3095 900; -643.0075 -467.1724 900; -408.6955 -453.9025 900; -320.1823 -554.5721 900; -229.6975 -706.9361 900; -71.09222 -676.3951 900; 79.15384 -753.1027 900; 179.0509 -551.0637 900; 391.6719 -678.3973 900; 439.7233 -488.3635 900; 412.9405 -300.0198 900; 560.3457 -249.4831 900; 552.0906 -117.3516 900; 662.0777 0 960; 696.9609 148.1436 960; 724.4409 322.5419 960; 598.9322 435.1497 960; 509.0381 565.3441 960; 388.9981 673.7645 960; 197.0819 606.5557 960; 81.9737 779.928 960; -56.02084 533.0024 960; -156.0902 480.3961 960; -266.8695 462.2315 960; -419.0795 465.4348 960; -522.062 379.3002 960; -536.8046 239.0007 960; -612.7418 130.2422 960; -692.5009 -6.054035E-05 960; -574.49 -122.1117 960; -497.4152 -221.4635 960; -518.6805 -376.8435 960; -403.349 -447.9646 960; -351.9905 -609.6656 960; -221.0835 -680.4249 960; -70.40961 -669.9004 960; 67.01011 -637.5622 960; 155.7729 -479.4209 960; 304.0242 -526.5866 960; 390.1126 -433.2651 960; 467.6668 -339.7809 960; 664.4125 -295.8169 960; 650.523 -138.2743 960; 508.3724 0 1020; 625.5946 132.9742 1020; 600.4826 267.3521 1020; 426.7665 310.064 1020; 389.9538 433.0877 1020; 309.7743 536.5448 1020; 226.8069 698.0399 1020; 78.55917 747.441 1020; -63.32257 602.4738 1020; -212.8049 654.9461 1020; -318.8694 552.298 1020; -439.9319 488.5938 1020; -417.0867 303.0312 1020; -721.4109 321.1928 1020; -564.4372 119.9748 1020; -514.0604 -4.494059E-05 1020; -584.9445 -124.3339 1020; -541.2895 -240.9977 1020; -510.3442 -370.7869 1020; -459.6402 -510.4822 1020; -348.0103 -602.7718 1020; -189.325 -582.6823 1020; -69.96099 -665.6321 1020; 53.36979 -507.7825 1020; 204.0878 -628.1194 1020; 373.3176 -646.6066 1020; 360.6214 -400.5117 1020; 527.4181 -383.1929 1020; 672.5773 -299.4521 1020; 638.4328 -135.7044 1020; 254.1862 0 1080; 312.7973 66.48712 1080; 300.2413 133.676 1080; 213.3833 155.032 1080; 194.9769 216.5438 1080; 154.8871 268.2724 1080; 113.4034 349.0199 1080; 39.27959 373.7205 1080; -31.66129 301.2369 1080; -106.4025 327.4731 1080; -159.4347 276.149 1080; -219.9659 244.2969 1080; -208.5434 151.5156 1080; -360.7055 160.5964 1080; -282.2186 59.98739 1080; -257.0302 -2.247029E-05 1080; -292.4723 -62.16693 1080; -270.6447 -120.4988 1080; -255.1721 -185.3934 1080; -229.8201 -255.2411 1080; -174.0052 -301.3859 1080; -94.66251 -291.3411 1080; -34.9805 -332.8161 1080; 26.68489 -253.8912 1080; 102.0439 -314.0597 1080; 186.6588 -323.3033 1080; 180.3107 -200.2558 1080; 263.709 -191.5964 1080; 336.2886 -149.726 1080; 319.2164 -67.8522 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080; 0 0 1080;"},
                new OptiNurbsImmediateResult{ Dpc = 20, ErrorValue = 1.10, ControlPoints = "0 0 100; 0 0 100; 0 0 100; 0 0 100; 0 0 100; 0 0 100; 0 0 100; 0 0 100; 0 0 100; 0 0 100; 117.8011 0 100; 53.07781 38.56329 100; 16.92098 52.07742 100; -27.26631 83.91707 100; -103.6921 75.33671 100; -54.59978 -4.773264E-06 100; -55.99566 -40.68324 100; -37.40286 -115.1141 100; 30.13972 -92.76049 100; 89.41132 -64.96107 100; 235.6021 0 200; 106.1556 77.12657 200; 33.84195 104.1548 200; -54.53262 167.8341 200; -207.3842 150.6734 200; -109.1996 -9.546528E-06 200; -111.9913 -81.36647 200; -74.80573 -230.2283 200; 60.27945 -185.521 200; 178.8226 -129.9221 200; 265.9678 0 300; 117.2824 85.21066 300; 50.12452 154.2674 300; -61.10915 188.0746 300; -205.2108 149.0944 300; -291.9656 -2.552444E-05 300; -102.6103 -74.55074 300; -69.26637 -213.1799 300; 43.6033 -134.1971 300; 93.19421 -67.7095 300; 265.0782 0 400; 140.4352 102.0321 400; 41.14986 126.6463 400; -50.30265 154.8156 400; -210.1064 152.6512 400; -160.884 -1.406492E-05 400; -159.1356 -115.6188 400; -76.55602 -235.6151 400; 31.10408 -95.72847 400; 127.0211 -92.28613 400; 202.1855 0 500; 231.6777 168.3237 500; 81.36149 250.405 500; -79.0631 243.3312 500; -235.7918 171.3127 500; -130.5868 -1.141626E-05 500; -235.625 -171.1916 500; -74.36604 -228.875 500; 40.68512 -125.2159 500; 144.4995 -104.985 500; 235.0091 0 600; 161.32 117.2058 600; 55.31046 170.2281 600; -59.05856 181.7635 600; -122.8845 89.28083 600; -112.6111 -9.844776E-06 600; -98.19493 -71.34281 600; -83.29753 -256.3633 600; 55.82333 -171.8065 600; 200.7779 -145.8736 600; 217.3962 0 700; 233.8967 169.9359 700; 51.67245 159.0315 700; -86.15578 265.1602 700; -175.2846 127.3517 700; -162.0147 -1.416378E-05 700; -241.129 -175.1905 700; -76.24442 -234.6561 700; 66.98425 -206.1562 700; 158.1281 -114.8867 700; 212.4972 0 800; 154.2702 112.0839 800; 74.60333 229.6055 800; -42.66341 131.3045 800; -96.15276 69.85906 800; -279.5985 -2.444328E-05 800; -146.9803 -106.7875 800; -63.76655 -196.2532 800; 63.74983 -196.2017 800; 180.4657 -131.1159 800; 100.7171 0 900; 150.6226 109.4337 900; 59.48294 183.0697 900; -81.11451 249.6447 900; -145.7729 105.9102 900; -165.6757 -1.448383E-05 900; -238.3356 -173.161 900; -74.79643 -230.1997 900; 34.26665 -105.4619 900; 199.9038 -145.2385 900; 139.5083 0 1000; 183.765 133.5131 1000; 51.63439 158.9143 1000; -47.11885 145.0169 1000; -193.8489 140.8394 1000; -213.0733 -1.862746E-05 1000; -177.2991 -128.8154 1000; -87.91085 -270.5617 1000; 43.01207 -132.3775 1000; 185.6208 -134.8613 1000; 132.535 0 1100; 116.9162 84.94461 1100; 38.2835 117.8245 1100; -72.99068 224.6422 1100; -215.2908 156.4179 1100; -144.3206 -1.261691E-05 1100; -208.711 -151.6375 1100; -43.54876 -134.0293 1100; 53.23318 -163.8348 1100; 139.3897 -101.2725 1100; 230.9334 0 1200; 173.9571 126.3872 1200; 50.44939 155.2673 1200; -79.59669 244.9734 1200; -200.1977 145.4521 1200; -131.2164 -1.147131E-05 1200; -159.0701 -115.5712 1200; -63.26308 -194.7037 1200; 61.37719 -188.8995 1200; 122.1518 -88.74842 1200; 167.4158 0 1300; 126.2111 91.69775 1300; 72.87946 224.2999 1300; -83.33288 256.4722 1300; -126.1651 91.66432 1300; -285.3512 -2.494619E-05 1300; -99.99129 -72.64794 1300; -58.38621 -179.6942 1300; 61.32486 -188.7384 1300; 166.478 -120.9533 1300; 160.4448 0 1400; 159.5319 115.9067 1400; 51.65617 158.9814 1400; -85.55409 263.3084 1400; -154.1443 111.9923 1400; -256.2007 -2.239778E-05 1400; -131.2968 -95.39274 1400; -79.1974 -243.7444 1400; 91.58588 -281.8723 1400; 109.9168 -79.85918 1400; 207.6947 0 1500; 205.2252 149.1048 1500; 52.46495 161.4705 1500; -73.72961 226.9164 1500; -93.97643 68.27785 1500; -224.4855 -1.962515E-05 1500; -132.5884 -96.33115 1500; -64.74284 -199.2579 1500; 63.35524 -194.9873 1500; 168.5943 -122.4908 1500; 116.4518 0 1600; 92.57594 67.26036 1600; 57.43536 176.7679 1600; -89.05933 274.0964 1600; -131.0803 95.23538 1600; -276.5294 -2.417497E-05 1600; -168.8204 -122.6552 1600; -47.65575 -146.6693 1600; 55.7016 -171.4318 1600; 227.142 -165.0282 1600; 120.7246 0 1700; 136.7557 99.35884 1700; 74.92902 230.6078 1700; -82.34935 253.4452 1700; -90.48887 65.744 1700; -133.7411 -1.169202E-05 1700; -119.6212 -86.9099 1700; -57.60043 -177.2758 1700; 51.62053 -158.8716 1700; 235.6322 -171.1966 1700; 60.3623 0 1800; 68.37785 49.67942 1800; 37.46451 115.3039 1800; -41.17467 126.7226 1800; -45.24443 32.872 1800; -66.87056 -5.84601E-06 1800; -59.81059 -43.45495 1800; -28.80021 -88.63792 1800; 25.81026 -79.43579 1800; 117.8161 -85.59832 1800; 0 0 1800; 0 0 1800; 0 0 1800; 0 0 1800; 0 0 1800; 0 0 1800; 0 0 1800; 0 0 1800; 0 0 1800; 0 0 1800;"}, 
                new OptiNurbsImmediateResult{ Dpc = 20, ErrorValue = 1.20, ControlPoints = "0 0 50; 0 0 50; 0 0 50; 0 0 50; 0 0 50; 0 0 50; 0 0 50; 0 0 50; 0 0 50; 0 0 50; 86.013 0 50; 94.26025 68.48408 50; 20.18901 62.13541 50; -6.549449 20.15713 50; -48.52026 35.25203 50; -5.297763 -4.631452E-07 50; -76.81949 -55.81264 50; -17.82177 -54.84974 50; 9.58987 -29.51457 50; 77.69569 -56.44918 50; 172.026 0 100; 188.5205 136.9682 100; 40.37803 124.2708 100; -13.0989 40.31425 100; -97.04053 70.50406 100; -10.59553 -9.262904E-07 100; -153.639 -111.6253 100; -35.64354 -109.6995 100; 19.17974 -59.02915 100; 155.3914 -112.8984 100; 126.3218 0 150; 219.1446 159.2179 150; 30.68408 94.43591 150; -56.38966 173.5495 150; -77.00313 55.94604 150; -183.8597 -1.607352E-05 150; -184.135 -133.782 150; -50.55079 -155.5793 150; 17.45882 -53.7327 150; 103.2557 -75.0196 150; 271.367 0 200; 108.4414 78.78728 200; 32.44759 99.86342 200; -2.232579 6.871169 200; -33.95925 24.67284 200; -42.15836 -3.685601E-06 200; -232.517 -168.9336 200; -8.930645 -27.48569 200; 60.56034 -186.3855 200; 206.0134 -149.6774 200; 137.2317 0 250; 202.4157 147.0636 250; 43.54682 134.0233 250; -81.74117 251.5734 250; -89.41413 64.96316 250; -60.60019 -5.297837E-06 250; -63.3008 -45.99073 250; -64.8613 -199.6225 250; 29.5715 -91.01168 250; 195.7511 -142.2213 250; 44.50768 0 300; 228.6893 166.1525 300; 50.39533 155.1009 300; -79.53054 244.7698 300; -198.8592 144.4796 300; -200.2017 -1.750219E-05 300; -82.95135 -60.2677 300; -55.77004 -171.6425 300; 28.31512 -87.14495 300; 226.4253 -164.5075 300; 134.1414 0 350; 17.4182 12.65506 350; 59.31956 182.5668 350; -33.93877 104.4528 350; -115.6554 84.02854 350; -42.98505 -3.757873E-06 350; -107.6167 -78.1881 350; -39.69055 -122.1549 350; 1.672702 -5.148045 350; 66.9788 -48.66291 350; 23.18865 0 400; 134.3034 97.5771 400; 67.7883 208.631 400; -33.19474 102.1629 400; -48.41365 35.17457 400; -176.1223 -1.53971E-05 400; -109.1826 -79.32585 400; -41.64804 -128.1794 400; 23.78159 -73.19218 400; 32.02163 -23.26506 400; 110.6156 0 450; 18.37111 13.34739 450; 22.52437 69.32288 450; -35.39369 108.9306 450; -71.2933 51.79761 450; -288.6914 -2.523821E-05 450; -219.2098 -159.2653 450; -45.62217 -140.4106 450; 18.98024 -58.41514 450; 114.6978 -83.33276 450; 239.6248 0 500; 90.55432 65.79156 500; 73.32063 225.6577 500; -66.77867 205.5236 500; -101.5358 73.77003 500; -120.7016 -1.055207E-05 500; -51.16014 -37.17003 500; -11.15314 -34.32583 500; 39.10984 -120.3676 500; 58.68359 -42.63609 500; 227.5787 0 550; 202.0947 146.8304 550; 64.73365 199.2297 550; -5.532958 17.02869 550; -181.0361 131.5304 550; -178.4996 -1.560493E-05 550; -55.26236 -40.15046 550; -18.74569 -57.69328 550; 62.58327 -192.6114 550; 60.41838 -43.89649 550; 70.24455 0 600; 216.6205 157.384 600; 33.53352 103.2056 600; -17.62903 54.25656 600; -140.9805 102.4283 600; -116.4335 -1.017894E-05 600; -201.1537 -146.1468 600; -25.47097 -78.39155 600; 8.25224 -25.39777 600; 124.8043 -90.67552 600; 72.02685 0 650; 230.8814 167.7451 650; 22.25539 68.49506 650; -50.56716 155.6297 650; -115.8233 84.15055 650; -211.2573 -1.84687E-05 650; -185.0525 -134.4486 650; -2.554727 -7.862638 650; 87.11667 -268.1174 650; 193.4691 -140.5634 650; 117.8848 0 700; 84.02843 61.05023 700; 4.08329 12.56708 700; -2.911538 8.960791 700; -90.61171 65.83325 700; -160.8127 -1.40587E-05 700; -91.60129 -66.55225 700; -18.5365 -57.04947 700; 58.94919 -181.4269 700; 169.5892 -123.2137 700; 225.3834 0 750; 174.1781 126.5478 750; 75.744 233.1161 750; -88.60757 272.706 750; -61.91381 44.98301 750; -271.8672 -2.376738E-05 750; -6.807505 -4.945943 750; -57.23671 -176.1564 750; 14.47399 -44.54634 750; 11.38418 -8.271088 750; 172.0619 0 800; 227.1814 165.057 800; 4.445986 13.68334 800; -84.14396 258.9684 800; -4.457713 3.238718 800; -242.1936 -2.117323E-05 800; -147.8744 -107.4371 800; -15.71159 -48.35529 800; 53.99751 -166.1872 800; 14.17036 -10.29536 800; 249.7621 0 850; 52.61909 38.23 850; 24.33414 74.89281 850; -81.38974 250.4918 850; -207.7527 150.9411 850; -266.3797 -2.328765E-05 850; -209.9754 -152.5561 850; -32.16708 -99.00006 850; 75.72356 -233.0531 850; 14.92535 -10.84389 850; 124.881 0 900; 26.30954 19.115 900; 12.16707 37.4464 900; -40.69487 125.2459 900; -103.8763 75.47055 900; -133.1898 -1.164383E-05 900; -104.9877 -76.27805 900; -16.08354 -49.50003 900; 37.86178 -116.5265 900; 7.462673 -5.421945 900; 0 0 900; 0 0 900; 0 0 900; 0 0 900; 0 0 900; 0 0 900; 0 0 900; 0 0 900; 0 0 900; 0 0 900;"}
            };
            //_results = results;
            // threadsafe lambda addition (?)
            results.ForEach(result => _results.TryAdd(result));

            // fire up timer
            // TODO: Periodical Scalarm data mosquito
            _timer = new Timer(UpdateResultList, null, _interval, _interval);
        }

        public static ImmediateResultTicker Instance
        {
            get
            {
                return _instance.Value;
            }
        }

        private IHubConnectionContext<dynamic> Clients
        {
            get;
            set;
        }

        // Client side data pull
        public IEnumerable<OptiNurbsImmediateResult> GetAllResults()
        {
            return _results;
        }

        // Timer callback that obtains data from Scalarm
        private void UpdateResultList(object state)
        {
            // lock
            BroadcastResult(_results.Take());
        }

        // Client method to post latest result state to (browser)
        private void BroadcastResult(OptiNurbsImmediateResult result)
        {
            Clients.All.updateResultsView(result);
        }


    }
}